<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rebote de una bolita</title>
    <style>
        *,
        body {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        #wrap {
            text-align: center;
            width: 800px;
            margin: 0 auto;
        }

        #lienzo {
            width: 800px;
            height: 600px;
            position: relative;
            overflow: hidden;
            background-color: #1d3557;
        }

        .circle {
            border-radius: 50%;
            position: absolute;
        }

        #info {
            display: flex;
            flex-flow: row wrap;
            justify-content: space-around;
        }

        .item {
            padding: 20px;
            margin: auto;
        }

        #controles {
            display: flex;
            gap: 12px;
            width: 100%;
            padding: 10px 0;
            box-sizing: border-box;
        }

        #controles input {
            flex: 1 1 0;
            min-width: 0;
            padding: 10px;
            font-size: 1rem;
            border: none;
            box-shadow: #333 0px 8px 4px 0px;
            background-color: #f1faee;
            border-radius: 2px;
        }

        #controles input[type="button"]:hover {
            background-color: #a8dadc;
        }

        #controles input[type="colorpicker"] {
            flex: 1 1 0;
            min-width: 0;
            padding: 10px;
            font-size: 1rem;
            padding: 10px;
            border: 0;
            height: 37px;
            margin: 0;
        }
        #editables {
            display: flex;
            gap: 12px;
            width: 100%;
            padding: 10px 0;
            box-sizing: border-box;
        }
        #editables label {
            flex: 1 1 0;
            min-width: 0;
            padding: 10px;
            font-size: 1rem;
            border: none;
            box-shadow: #333 0px 8px 4px 0px;
            background-color: #f1faee;
            border-radius: 2px;
        }
    </style>
</head>

<body>
    <div id="wrap">
        <h1>Programa de rebote de una bolita</h1>
        <p>En esta animación vamos a simular el rebote de una bolita
            por un espacio cuadrado.</p>
        <div id="controles">
            <input type="button" value="Iniciar" id="btnStart">
            <input type="button" value="Detener" id="btnPause">
            <input type="button" value="Reiniciar" id="btnReset">
        </div>
        <div id="lienzo"></div>
        <div id="info">
            <div class="item">
                <div class="label">Posicion X</div>
                <div class="value" id="posX"></div>
            </div>

            <div class="item">
                <div class="label">Posicion Y</div>
                <div class="value" id="posY"></div>
            </div>

            <div class="item">
                <div class="label">Vel X</div>
                <div class="value" id="velX"></div>
            </div>
            <div class="item">
                <div class="label">Vel Y</div>
                <div class="value" id="velY"></div>
            </div>

            <div class="item">
                <div class="label">Rebotes</div>
                <div class="value" id="bounceCount"></div>
            </div>
        </div>
        <!--Editables-->
        <div id="editables">
            <label for="colorPicker"> Color:
                <input type="color" id="colorPicker" value="#ff4757">
            </label>
            <label for="radius"> Radius:
                <input type="range" id="radius" max="100" value="40" min="20">
            </label>
            <label for="speed">Speed:
                <input type="range" id="speed" max="100" value="30" min="7">
            </label>
        </div>

    </div>



    <script>
        class Moving {
            #x;
            #y;
            #dx;
            #dy;

            constructor(x, y, dx, dy) {
                this.#x = x;
                this.#y = y;
                this.#dx = dx;
                this.#dy = dy;
            }
            get x() {
                return this.#x;
            }
            set x(value) {
                this.#x = value;
            }
            get y() {
                return this.#y;
            }
            set y(value) {
                this.#y = value;
            }
            get dx() {
                return this.#dx;
            }
            set dx(value) {
                this.#dx = value;
            }
            get dy() {
                return this.#dy;
            }
            set dy(value) {
                this.#dy = value;
            }

            updatePosition() {
                this.#x += this.#dx;
                this.#y += this.#dy;
            }
        }
        class Circle extends Moving {
            #radius;
            #color;
            #element;

            constructor(x, y, dx, dy, radius, color) {
                super(x, y, dx, dy);
                this.#color = color;
                this.#radius = radius;
                this.#element = null;
            }
            //Getters y Setters
            get radius() { return this.#radius; }
            set radius(value) { this.#radius = value; }

            get color() { return this.#color; }
            set color(value) { this.#color = value; }

            get element() { return this.#element; }

            // Método para crear el elemento visual del círculo
            createElement() {
                const circleElement = document.createElement('div');
                circleElement.className = 'circle';
                circleElement.style.width = `${this.#radius * 2}px`;
                circleElement.style.height = `${this.#radius * 2}px`;
                circleElement.style.backgroundColor = this.#color;
                circleElement.style.left = `${this.x - this.#radius}px`;
                circleElement.style.top = `${this.y - this.#radius}px`;

                this.#element = circleElement;
                return circleElement;
            }

            // Método para actualizar la posición visual del círculo
            updateElement() {
                if (this.#element) {
                    this.#element.style.left = `${this.x - this.#radius}px`;
                    this.#element.style.top = `${this.y - this.#radius}px`;
                    this.#element.style.backgroundColor = this.#color;
                    this.#element.style.width = `${this.#radius * 2}px`;
                    this.#element.style.height = `${this.#radius * 2}px`;
                }
            }

        }

        class Main {
            #container;
            #circle;
            #animateID;
            #isRunning;
            #bounceCount;
            #speed;

            constructor(containerID) {
                this.#container = document.getElementById(containerID);
                this.#circle = null;
                this.#animateID = null;
                this.#isRunning = false;
                this.#bounceCount = 0;
                this.#speed = 3;

                //Inicar el programa
                this.init();

                //Escuchar los controles
                this.initEventListeners();
            }
            init() {
                const containerRect = this.#container.getBoundingClientRect();
                const radius = 40;

                //Posicion iniical centrada
                const x = containerRect.width / 2;
                const y = containerRect.height / 2;

                //Velocidad inicial
                const dx = this.#speed;
                const dy = this.#speed;

                //Crear el circulo
                this.#circle = new Circle(x, y, dx, dy, radius, '#e63946');
                this.#container.appendChild(this.#circle.createElement());

                //Actualizar la información en el panel
                this.updateInfo();
            }
            initEventListeners() {
                document.getElementById('btnStart').addEventListener('click', () => {
                    //llamar al metodo start
                    this.start();
                });


                document.getElementById('btnPause').addEventListener('click', () => {
                    //llamar al metodo pause
                    this.pause();
                });


                document.getElementById('btnReset').addEventListener('click', () => {
                    //llamar al metodo reset
                    this.reset();
                });
                //Editables
                //Cambiar el color
                document.getElementById('colorPicker').addEventListener('input', (e) => {
                    if (this.#circle) {
                        this.#circle.color = e.target.value;
                    }
                });
                //Cambiar radio
                document.getElementById('radius').addEventListener('input', (e) => {
                    if (this.#circle) {
                        this.#circle.radius = parseInt(e.target.value);
                        this.#circle.updateElement();
                    }
                });
                document.getElementById('speed').addEventListener('input', (e) => {
                    if (this.#circle) {
                        const speed = parseInt(e.target.value);
                        // Ajustar la velocidad manteniendo la dirección
                        const currentSpeed = Math.sqrt(this.#circle.dx ** 2 + this.#circle.dy ** 2);
                        const ratio = speed / currentSpeed;

                        this.#circle.dx *= ratio;
                        this.#circle.dy *= ratio;
                    }
                });

            }

            start() {
                if (!this.#isRunning) {
                    this.#isRunning = true;
                    //llamar al metodo animate
                    this.animate();
                }
            }
            pause() {
                this.#isRunning = false;
                if (this.#animateID) {
                    //Cancelar animación en el canvas - container
                    cancelAnimationFrame(this.#animateID);
                    this.#animateID = null;
                }
            }
            reset() {
                this.pause();
                this.#bounceCount = 0;

                const containerRect = this.#container.getBoundingClientRect();
                const radius = this.#circle.radius;

                const x = containerRect.width / 2;
                const y = containerRect.height / 2;

                const dx = Math.random() < 0.5 ? this.#speed : (-1 * (this.#speed));
                const dy = Math.random() < 0.5 ? this.#speed : (-1 * (this.#speed));

                this.#circle.x = x;
                this.#circle.y = y;

                this.#circle.dx = dx;
                this.#circle.dy = dy;

                this.#circle.updateElement();

                //Actualizar la información del Panel
                this.updateInfo();

            }

            updateInfo() {
                if (this.#circle) {
                    document.getElementById('posX').textContent = Math.round(this.#circle.x);
                    document.getElementById('posY').textContent = Math.round(this.#circle.y);
                    document.getElementById('velX').textContent = this.#circle.dx.toFixed(1);
                    document.getElementById('velY').textContent = this.#circle.dy.toFixed(1);
                    document.getElementById('bounceCount').textContent = this.#bounceCount;

                }
            }
            // Método principal de animación
            animate() {
                if (!this.#isRunning) return;

                const containerRect = this.#container.getBoundingClientRect();
                const containerWidth = containerRect.width;
                const containerHeight = containerRect.height;

                // Actualizar posición del círculo
                this.#circle.updatePosition();

                // Detectar colisión con los bordes del contenedor
                let bounced = false;

                if (this.#circle.x - this.#circle.radius <= 0) {
                    this.#circle.dx = Math.abs(this.#circle.dx);
                    this.#circle.x = this.#circle.radius;
                    bounced = true;
                } else if (this.#circle.x + this.#circle.radius >= containerWidth) {
                    this.#circle.dx = -Math.abs(this.#circle.dx);
                    this.#circle.x = containerWidth - this.#circle.radius;
                    bounced = true;
                }

                if (this.#circle.y - this.#circle.radius <= 0) {
                    this.#circle.dy = Math.abs(this.#circle.dy);
                    this.#circle.y = this.#circle.radius;
                    bounced = true;
                } else if (this.#circle.y + this.#circle.radius >= containerHeight) {
                    this.#circle.dy = -Math.abs(this.#circle.dy);
                    this.#circle.y = containerHeight - this.#circle.radius;
                    bounced = true;
                }

                // Incrementar contador de rebotes si hubo colisión
                if (bounced) {
                    this.#bounceCount++;

                }

                // Actualizar elemento visual
                this.#circle.updateElement();

                // Actualizar panel de información
                this.updateInfo();

                // Solicitar siguiente frame de animación
                this.#animateID = requestAnimationFrame(() => this.animate());
            }
        }

        //Inicializar la animación invocando a Main
        document.addEventListener('DOMContentLoaded', () => {
            const villegas = new Main('lienzo');
            villegas.start();
        });


    </script>
</body>

</html>