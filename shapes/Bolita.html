<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rebote de una bolita</title>
</head>

<body>



    <script>
        class Moving {
            #x;
            #y;
            #dx;
            #dy;

            constructor(x, y, dx, dy) {
                this.#x = x;
                this.#y = y;
                this.#dx = dx;
                this.#dy = y;
            }
            get x() {
                return this.#x;
            }
            set x(value) {
                this.#x = value;
            }
            get y() {
                return this.#y;
            }
            set y(value) {
                this.#y = value;
            }
            get dx() {
                return this.#dx;
            }
            set dx(value) {
                this.#dx = value;
            }
            get dy() {
                return this.#dy;
            }
            set dy(value) {
                this.#dy = value;
            }

            updatePosition() {
                this.#x += this.#dx;
                this.#y += this.#dy;
            }
        }
        class Circle extends Moving {
            #radius;
            #color;
            #element;

            constructor(x, y, dx, dy, radius, color) {
                super(x, y, dx, dy);
                this.#color = color;
                this.#radius = radius;
                this.#element = null;
            }
            //Getters y Setters
            get radius() { return this.#radius; }
            set radius(value) { this.#radius = value; }

            get color() { return this.#color; }
            set color(value) { this.#color = value; }

            get element() { return this.#element; }

            //Método para crear el element visual del circulo
            createElement() {
                const circleElement = document.createElement('div');
                circleElement.className = "circle";
                circleElement.style.width = `${this.#radius * 2}px`;
                circleElement.style.height = (this.#radius * 2) + 'px';
                circleElement.style.backgroundColor = this.#color;
                circleElement.style.top = (this.y - (this.#radius * 2)) + "px";
                circleElement.style.left = (this.x - (this.#radius * 2)) + "px";

                this.#element = circleElement;
                return circleElement;

            }
            updateElement() {
                if (this.#element) {
                    circleElement.style.width = `${this.#radius * 2}px`;
                    circleElement.style.height = (this.#radius * 2) + 'px';
                    circleElement.style.backgroundColor = this.#color;
                    circleElement.style.top = (this.y - (this.#radius * 2)) + "px";
                    circleElement.style.left = (this.x - (this.#radius * 2)) + "px";
                }
            }

        }

        class Main {
            #container;
            #circle;
            #animateID;
            #isRunning;
            #bounceCount;

            constructor(containerID) {
                this.#container = document.getElementById(containerID);
                this.#circle = null;
                this.#animateID = null;
                this.#isRunning = false;
                this.#isRunning = 0;

                //Inicar el programa
                init();

                //Escuchar los controles
                initEventListeners();
            }
            init() {
                const containerRect = this.#container.getBoundingClientRect();
                const radius = 40;

                //Posicion iniical centrada
                const x = containerRect.width / 2;
                const y = containerRect.height / 2;

                //Velocidad inicial
                const dx = 3;
                const dy = 3;

                //Crear el circulo
                this.#circle = new Circle(x, y, dx, dy, radius, '#fb8b24');
                this.#container.appendChild(this.#circle.createElement());

                //Actualizar la información en el panel
                updateInfo();
            }
            initEventListeners() {
                document.getElementById('btnStart').addEventListener('click', () => {
                    //llamar al metodo start
                    this.start();
                });


                document.getElementById('btnPause').addEventListener('click', () => {
                    //llamar al metodo pause
                    this.pause();
                });


                document.getElementById('btnReset').addEventListener('click', () => {
                    //llamar al metodo reset
                    this.reset();
                });

            }

            start(){
                if(!this.#isRunning){
                    this.#isRunning=true;
                    //llamar al metodo animate
                    this.animate();
                }
            }
            pause(){
                this.#isRunning=false;
                if(this.#animateID){
                    //Cancelar animación en el canvas - container
                    cancelAnimationFrame(this.#animateID);
                    this.#animateID=null;
                }
            }
            reset(){
                this.pause();
                this.#bounceCount=0;

                const containerRect=this.#container.getBoundingClientRect();
                const radius=this.#circle.radius;

                const x=containerRect.width/2;
                const y=containerRect.height/2;

                const dx=3;
                const dy=3;

                this.#circle.x=x;
                this.#circle.y=y;

                this.#circle.dx=dx;
                this.#circle.dy=dy;

                this.#circle.updateElement();
                
                //Actualizar la información del Panel
                this.updateInfo();

            }

            updateInfo(){
                if(this.#circle){
                    document.getElementById('posX').textContent=Math.round(this.#circle.x);
                    document.getElementById('posY').textContent=Math.round(this.#circle.y);
                    document.getElementById('velX').textContent=this.#circle.dx.toFixed(1);
                    document.getElementById('velY').textContent=this.#circle.dy.toFixed(1);
                    document.getElementById('bounceCount').textContent=this.#bounceCount;

                }
            }
            // Método principal de animación
            animate() {
                if (!this.#isRunning) return;
                
                const containerRect = this.#container.getBoundingClientRect();
                const containerWidth = containerRect.width;
                const containerHeight = containerRect.height;
                
                // Actualizar posición del círculo
                this.#circle.updatePosition();
                
                // Detectar colisión con los bordes del contenedor
                let bounced = false;
                
                if (this.#circle.x - this.#circle.radius <= 0) {
                    this.#circle.dx = Math.abs(this.#circle.dx);
                    this.#circle.x = this.#circle.radius;
                    bounced = true;
                } else if (this.#circle.x + this.#circle.radius >= containerWidth) {
                    this.#circle.dx = -Math.abs(this.#circle.dx);
                    this.#circle.x = containerWidth - this.#circle.radius;
                    bounced = true;
                }
                
                if (this.#circle.y - this.#circle.radius <= 0) {
                    this.#circle.dy = Math.abs(this.#circle.dy);
                    this.#circle.y = this.#circle.radius;
                    bounced = true;
                } else if (this.#circle.y + this.#circle.radius >= containerHeight) {
                    this.#circle.dy = -Math.abs(this.#circle.dy);
                    this.#circle.y = containerHeight - this.#circle.radius;
                    bounced = true;
                }
                
                // Incrementar contador de rebotes si hubo colisión
                if (bounced) {
                    this.#bounceCount++;
                }
                
                // Actualizar elemento visual
                this.#circle.updateElement();
                
                // Actualizar panel de información
                this.updateInfo();
                
                // Solicitar siguiente frame de animación
                this.#animateID = requestAnimationFrame(() => this.animate());
            }
        }

        //Inicializar la animación invocando a Main
        document.addEventListener('DOMContentLoaded',()=>{
            const villegas = new Main('lienzo');
            villegas.start();
        });


    </script>
</body>

</html>