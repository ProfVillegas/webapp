<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tienda Las Manzanitas</title>
</head>
<body>

    <script>
        // ========== MODELO ==========

        // Clase padre Producto
        class Producto {
            constructor(id, nombre, precio, stock, categoria) {
                this.id = id;
                this.nombre = nombre;
                this.precio = precio;
                this.stock = stock;
                this.categoria = categoria;
            }

            // M√©todo para obtener informaci√≥n b√°sica del producto
            obtenerInfo() {
                return `${this.nombre} : $ ${this.precio.toFixed(2)}`;
            }

            // M√©todo para verificar disponibilidad
            estaDisponible(cantidad =1) {
                return this.stock>=cantidad;
                
            }

            // M√©todo para reducir stock
            reducirStock(cantidad = 1) {
                if(this.estaDisponible(cantidad)){
                    this.stock-=cantidad;
                    return true;
                }
                return false;
            }

            // M√©todo para aumentar stock
            aumentarStock(cantidad =1) {
                this.stock+=cantidad;
            }
        }

        // Clase hija Fruta que hereda de Producto
        class Fruta extends Producto {
            constructor(id, nombre, precio, stock, categoria, temporada, origen) {
                super(id, nombre, precio, stock, categoria);
                this.temporada = temporada;
                this.origen = origen;
            }

            // Polimorfismo: Sobrescribimos el m√©todo obtenerInfo
            obtenerInfo() {
               return `${this.nombre} : $ ${this.precio.toFixed(2)} (${this.temporada})`;
            }

            // M√©todo espec√≠fico para frutas
            esDeTemporada() {
                const mesActual = new Date().getMonth()+1;
                return this.temporada.includes(mesActual);
            }
        }

        // Clase para el carrito de compras
        class Carrito {
            constructor() {
                this.items = [];
            }

            // Agregar producto al carrito
            agregarProducto(producto, cantidad = 1) {
                const itemExist = this.items.find(item=>item.producto.id===producto.id);
                if(itemExist){
                    itemExist.cantidad+=cantidad;
                } else {
                    this.items.push({
                        producto:producto,
                        cantidad:cantidad
                    });
                }
            }

            // Eliminar producto del carrito
            eliminarProducto(id) {
                this.items=this.items.filter(item=> item.producto.id !==id);

            }

            // Actualizar cantidad de un producto
            actualizarCantidad(id, cantidad) {
                const item = this.items.find(item => item.producto.id===id);
                if(item){
                    if(cantidad<=0){
                        this.eliminarProducto(id);
                    } else {
                        item.cantidad=cantidad;
                    }
                }
            }

            // Calcular el total del carrito
            calcularTotal() {
                return this.items.reduce((total, item)=>{
                    return total+(item.producto.precio * item.producto.cantidad);
                },0);
            }

            // Vaciar el carrito
            vaciar() {
                this.items=[];
            }

            // Realizar compra (reducir stock de productos)
            realizarCompra() {
                const productosSinStock=[];

                this.items.forEach( item =>{
                    if(!item.producto.estaDisponible(item.cantidad)){
                        productosSinStock.push(item.producto.nombre);
                    }
                });

                if(productosSinStock.length>0){
                    return{
                        exito:false,
                        mensaje:`No hay suficiente stock para: ${productosSinStock.join(', ')}`,
                        total:total
                    }
                }

            }
        }

        // Clase para gestionar el inventario
        class Inventario {
            constructor() {
                this.productos = [];
                this.cargarProductosIniciales();
            }

            // Cargar productos de ejemplo
            cargarProductosIniciales() {
                this.productos=[
                    new Fruta(1,"Manzana Roja",48.50,50,"frutilla",[9,10,11,12],"Argentina"),
                    new Fruta(2, "Platano Chiapas",17.40,100,'tropical',[1,2,3,4,5,6,7,8,9,10,11,12],"M√©xico"),
                    new Fruta(3, "Naranja", 1.50, 30, "citrico", [5, 6, 7, 8, 9, 10], "Espa√±a"),
                    new Fruta(4, "Fresa", 2.50, 20, "frutilla", [3, 4, 5, 6], "M√©xico"),
                    new Fruta(5, "Pi√±a", 3.00, 15, "tropical", [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12], "Costa Rica"),
                    new Fruta(6, "Lim√≥n", 1.00, 40, "citrico", [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12], "Argentina"),
                    new Fruta(7, "Uva", 2.20, 25, "frutilla", [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12], "Chile"),
                    new Fruta(8, "Mango Ata√∫lfo", 2.80, 18, "tropical", [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12], "M√©xico"),
                    new Fruta(9, "Pera", 1.70, 35, "frutilla", [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12], "Argentina"),
                    new Fruta(10, "Kiwi", 2.10, 22, "frutilla", [3, 4, 5, 6, 7, 8, 9], "Nueva Zelanda")


                ];
            }

            // Obtener todos los productos
            obtenerProductos() {
                return this.productos;
            }

            // Obtener productos por categor√≠a
            obtenerProductosPorCategoria(categoria) {
                if (categoria === "todos") {
                    return this.productos;
                }
                return this.productos.filter(producto => producto.categoria === categoria);
            }

            // Buscar producto por ID
            obtenerProductoPorId(id) {
                return this.productos.find(producto => producto.id === id);
            }
        }

        // ========== VISTA ==========

        class Vista {
            constructor() {
                this.productosContainer = document.getElementById('productos-container');// Contenedor de los productos (frutas)
                this.carritoItems = document.getElementById('carrito-items'); // Contenedor de los productos que se agreguen a la compra
                this.carritoTotal = document.getElementById('carrito-total'); // Contenedor de el total a pagar
                this.btnComprar = document.getElementById('btn-comprar');// Bot√≥n par agregar productos
                this.filtros = document.querySelectorAll('.filtro-btn');// Bot√≥n para filtrar
            }

            // Mostrar productos en la interfaz
            mostrarProductos(productos) {
                //Inicializamos el conteedor de productor en blanco
                 this.productosContainer.innerHTML = '';
                 
                 //Se verifica que exista alg√∫n producto
                 if (productos.length === 0) {
                    this.productosContainer.innerHTML = '<div class="vacio">No hay productos disponibles</div>';
                    return;
                }

                //Se hace el listado de iconos
                // Emoji representativo para cada fruta usando el ID del producto
                    const emojis = {
                        1: "üçé",
                        2: "üçå",
                        3: "üçä",
                        4: "üçì",
                        5: "üçç",
                        6: "üçã",
                        7: "üçá",
                        8: "ü•≠",
                        9: "üçê",
                        10: "ü•ù"
                    };

                //Si existe ,se recorrre todos los productos del array
                productos.forEach(producto => {
                    //Creamos el DIV para contener la informaci√≥n del producto
                    const productoCard = document.createElement('div');

                    //Se le agrega la clase al DIV nuevo
                    productoCard.className = 'producto-card';
                    
                    
                    //Si no existe arreglo se toma como predeterminado el primer icono
                    const emoji = emojis[producto.id] || "üçé";

                    //Se crea la estructura de cada de producto
                    productoCard.innerHTML = `
                        <div class="producto-imagen">${emoji}</div>
                        <div class="producto-info">
                            <h3 class="producto-nombre">${producto.nombre}</h3>
                            <p class="producto-precio">$${producto.precio.toFixed(2)}</p>
                            <p class="producto-descripcion">Origen: ${producto.origen}</p>
                            <p class="producto-stock">Stock: ${producto.stock} unidades</p>
                            <div class="producto-acciones">
                                <button class="btn btn-agregar" data-id="${producto.id}">Agregar al carrito</button>
                            </div>
                        </div>
                    `;
                    //Se agrega al contenedor el producto el nuevo producto
                    this.productosContainer.appendChild(productoCard);
                });
                
            }

            // Mostrar items del carrito
            mostrarCarrito(carrito) {
                this.carritoItems.innerHTML = '';

                if (carrito.items.length === 0) {
                    this.carritoItems.innerHTML = '<div class="vacio">Tu carrito est√° vac√≠o</div>';
                    this.carritoTotal.textContent = 'Total: $0.00';
                    return;
                }

                carrito.items.forEach(item => {
                    const carritoItem = document.createElement('div');
                    carritoItem.className = 'carrito-item';
                    
                    carritoItem.innerHTML = `
                        <div class="carrito-item-info">
                            <h4>${item.producto.nombre}</h4>
                            <p>$${item.producto.precio.toFixed(2)} c/u</p>
                        </div>
                        <div class="carrito-item-cantidad">
                            <button class="cantidad-btn" data-id="${item.producto.id}" data-accion="restar">-</button>
                            <span>${item.cantidad}</span>
                            <button class="cantidad-btn" data-id="${item.producto.id}" data-accion="sumar">+</button>
                            <button class="btn btn-eliminar" data-id="${item.producto.id}">Eliminar</button>
                        </div>
                    `;

                    this.carritoItems.appendChild(carritoItem);
                });

                this.carritoTotal.textContent = `Total: $${carrito.calcularTotal().toFixed(2)}`;
            }

            // Mostrar mensaje al usuario
            mostrarMensaje() {
               alert(mensaje); // En una aplicaci√≥n real, usar√≠amos un sistema de notificaciones m√°s elegante
            }

            // Actualizar filtros activos
            actualizarFiltros(filtroActivo) {
                this.filtros.forEach(btn => {
                    if (btn.getAttribute('data-filtro') === filtroActivo) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
            } 
        }

        // ========== CONTROLADOR ==========

        class Controlador {
            constructor(modelo, vista) {
                this.modelo = modelo;
                this.vista = vista;
                this.carrito = new Carrito();
                
                this.inicializarEventos();
                this.cargarProductos();
            }

            // Inicializar eventos de la interfaz
            inicializarEventos() {
                // Evento para agregar productos al carrito
                this.vista.productosContainer.addEventListener('click', (e) => {
                    if (e.target.classList.contains('btn-agregar')) {
                        const id = parseInt(e.target.getAttribute('data-id'));
                        this.agregarAlCarrito(id);
                    }
                });

                // Evento para modificar cantidad en el carrito
                this.vista.carritoItems.addEventListener('click', (e) => {
                    if (e.target.classList.contains('cantidad-btn')) {
                        const id = parseInt(e.target.getAttribute('data-id'));
                        const accion = e.target.getAttribute('data-accion');
                        this.modificarCantidad(id, accion);
                    }
                    
                    if (e.target.classList.contains('btn-eliminar')) {
                        const id = parseInt(e.target.getAttribute('data-id'));
                        this.eliminarDelCarrito(id);
                    }
                });

                // Evento para realizar compra
                this.vista.btnComprar.addEventListener('click', () => {
                    this.realizarCompra();
                });

                // Eventos para filtros
                this.vista.filtros.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const filtro = e.target.getAttribute('data-filtro');
                        this.filtrarProductos(filtro);
                    });
                });
            }

           // Cargar productos en la vista
            cargarProductos(filtro = 'todos') {
                const productos = this.modelo.obtenerProductosPorCategoria(filtro);
                this.vista.mostrarProductos(productos);
                this.vista.actualizarFiltros(filtro);
            }

            // Filtrar productos por categor√≠a
            filtrarProductos(categoria) {
                this.cargarProductos(categoria);
            }

            // Agregar producto al carrito
            agregarAlCarrito(id) {
                const producto = this.modelo.obtenerProductoPorId(id);
                
                if (producto && producto.estaDisponible()) {
                    this.carrito.agregarProducto(producto);
                    this.vista.mostrarCarrito(this.carrito);
                    this.vista.mostrarMensaje(`${producto.nombre} agregado al carrito`);
                } else {
                    this.vista.mostrarMensaje('Producto no disponible', 'error');
                }
            }

            // Eliminar producto del carrito
            eliminarDelCarrito(id) {
                this.carrito.eliminarProducto(id);
                this.vista.mostrarCarrito(this.carrito);
            }

            // Modificar cantidad de producto en el carrito
            modificarCantidad(id, accion) {
                const item = this.carrito.items.find(item => item.producto.id === id);
                
                if (item) {
                    let nuevaCantidad = item.cantidad;
                    
                    if (accion === 'sumar') {
                        nuevaCantidad++;
                    } else if (accion === 'restar') {
                        nuevaCantidad--;
                    }
                    
                    this.carrito.actualizarCantidad(id, nuevaCantidad);
                    this.vista.mostrarCarrito(this.carrito);
                }
            }

            // Realizar compra
            realizarCompra() {
                if (this.carrito.items.length === 0) {
                    this.vista.mostrarMensaje('El carrito est√° vac√≠o', 'error');
                    return;
                }

                const resultado = this.carrito.realizarCompra();
                
                if (resultado.exito) {
                    this.vista.mostrarMensaje(resultado.mensaje, 'exito');
                    this.vista.mostrarCarrito(this.carrito);
                    this.cargarProductos(); // Recargar productos para actualizar stock
                } else {
                    this.vista.mostrarMensaje(resultado.mensaje, 'error');
                }
            }
        }
        // ========== INICIALIZACI√ìN ==========

        // Inicializar la aplicaci√≥n cuando el DOM est√© listo
        document.addEventListener('DOMContentLoaded', () => {
            const inventario = new Inventario();
            const vista = new Vista();
            new Controlador(inventario, vista);
        });
    </script>
</body>
</html>